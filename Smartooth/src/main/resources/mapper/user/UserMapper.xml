<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.smartooth.mapper.UserMapper">
    <cache />

	<!-- 사용자 목록 조회 -->
    <select id="selectUserList" parameterType="String" resultType="hashmap">
         SELECT USER_NO
         			,USER_ID 
				    ,USER_NM 
				    ,USER_PWD 
				    ,USER_NICKNAME 
				    ,DATE_FORMAT(USER_BIRTHDAY, '%Y %m %d %Hh%im%ss') AS USER_BIRTHDAY
				    ,USER_COUNTRY 
				    ,USER_STATE     
				    ,USER_ADDRESS 
				    ,USER_TEL_NO 
				    ,USER_SEX 
				    ,DATE_FORMAT(USER_RGST_DT, '%Y %m %d %Hh%im%ss') AS USER_RGST_DT
				    ,USER_PUSH_TOKEN 
				    ,USER_DELETE_YN 
				    ,DATE_FORMAT(USER_DELETE_DT, '%Y %m %d %Hh%im%ss') AS USER_DELETE_DT
				    ,USER_EMAIL_YN
				    ,AUTH_KEY
				    ,AUTH_STATUS
				    ,DATE_FORMAT(LOGIN_DT, '%Y %m %d %Hh%im%ss') AS LOGIN_DT
				    ,LOGIN_CK
		FROM ST_USER
		WHERE 1=1
		<if test=" userId != null and userId != '' ">
			AND USER_ID = #{userId}
   		 </if> 
    </select>


	<!-- 사용자 번호 (회원 번호) 생성 전 SEQ_NO 조회 -->
    <select id="selectUserSeqNo" resultType="Integer">
        SELECT SEQ_NO
		  FROM ST_USER_SEQ
    </select>
    
    
    <!-- 사용자 등록 :: 사용자 ID, 사용자 인증번호 생성-->
    <insert id="insertUser" parameterType="co.smartooth.vo.UserVO">
    	INSERT INTO ST_USER
    	(
    		USER_ID
    		,USER_NM
    		,USER_PWD
    		,USER_NICKNAME
    		,USER_BIRTHDAY
    		,USER_COUNTRY
    		,USER_STATE
    		,USER_ADDRESS
    		,USER_TEL_NO
    		,USER_SEX
    		,USER_RGST_DT
    		,USER_PUSH_TOKEN
    		,USER_DELETE_YN
    		,USER_DELETE_DT
    		,USER_EMAIL_YN
    		,AUTH_KEY
    		,AUTH_STATUS
    		,LOGIN_DT
    		,LOGIN_CK
    	)
    	VALUES
    	(
    		#{userId}
    		,#{userNm}
    		,#{userPwd}
    		,#{userNickname}
    		,#{userBirthday}
    		,#{userCountry}
    		,#{userState}
    		,#{userAddress}
    		,#{userTelNo}
    		,#{userSex}
    		,SYSDATE()
    		,#{userPushToken}
    		,'N'
    		,NULL
    		,'N'
    		,NULL
    		,'N'
    		,SYSDATE()
    		,0
   		)
    </insert>
    
    <!-- 사용자 정보 업데이트 (실질적인 Parameter를 받아 회원정보를 업데이트 한다 - 회원가입) -->
    <update id="updateUser" parameterType="co.smartooth.vo.UserVO">
		UPDATE ST_USER
		SET  USER_NO = #{userNo}
			   ,USER_NM = #{userNm}
			   ,USER_PWD = #{userPwd}
			   ,USER_NICKNAME = #{userNickname}
			   ,USER_BIRTHDAY = #{userBirthday}
			   ,USER_COUNTRY = #{userCountry}
			   ,USER_STATE = #{userState}
			   ,USER_ADDRESS = #{userAddress}
			   ,USER_TEL_NO = #{userTelNo}
			   ,USER_SEX = #{userSex}
			   ,USER_RGST_DT = SYSDATE()
			   ,USER_PUSH_TOKEN = #{userPushToken}
			   ,USER_EMAIL_YN = #{userEmailYn}
		WHERE 1=1
		AND USER_ID = #{userId}
    </update>
    
    <!-- 사용자 번호 (회원 번호 생성 후 증가한 SEQ_NO) 업데이트 --> 
    <update id="updateUserSeqNo" parameterType="Integer">
	    UPDATE ST_USER_SEQ
	    SET SEQ_NO =  #{seqNo}
    </update>

    
    
    
    
    
    
<!--     <select id="selectUserCnt" resultType="Integer"> -->
<!--         SELECT COUNT(*) FROM ST_USER -->
<!--     </select> -->
    
    
<!--     <resultMap type="co.smartooth.dto.UserDto" id="selectUserList"> -->
<!--         <result property="userNo" column="USER_NO"/> -->
<!--         <result property="userId" column="USER_ID"/> -->
<!--         <result property="userNm" column="USER_NAME"/> -->
<!--         <result property="userPwd" column="USER_PWD"/> -->
<!--         <result property="userNickname" column="USER_NICKNAME"/> -->
<!--         <result property="birthDay" column="BIRTHDAY"/> -->
<!--         <result property="sex" column="SEX"/> -->
<!--         <result property="email" column="EMAIL"/> -->
<!--         <result property="emailYn" column="EMAIL_YN"/> -->
<!--         <result property="telNum" column="TEL_NUM"/> -->
<!--         <result property="deleteYn" column="DELETE_YN"/> -->
<!--         <result property="deleteDt" column="DELETE_DT"/> -->
<!--         <result property="loginCk" column="LOGIN_CK"/> -->
<!--         <result property="rgstDt" column="RGST_DT"/> -->
<!--     </resultMap> -->
</mapper>